(function(a){"use strict";a.MaskedInput=function(c){if(!c||!c.elm||!c.format)return null;if(!(this instanceof a.MaskedInput))return new a.MaskedInput(c);var f=this,b=c.elm,d=c.format,g=c.allowed||"0123456789",l=c.separator||"/:-",k=c.typeon||"_YMDhms",t=c.onbadkey||function(){},v=c.badkeywait||0,u="preserve"in c?!!c.preserve:true,i=false,n=d,h=function(){return window.addEventListener?function(c,b,d,a){c.addEventListener(b,d,a===undefined?false:a)}:window.attachEvent?function(b,a,c){b.attachEvent("on"+a,c)}:function(b,a,c){b["on"+a]=c}}(),w=function(){if(!b.tagName||b.tagName.toUpperCase()!=="INPUT"&&b.tagName.toUpperCase()!=="TEXTAREA")return null;if(!u||b.value=="")b.value=d;h(b,"keydown",function(a){r(a)});h(b,"keypress",function(a){q(a)});h(b,"focus",function(){n=b.value});h(b,"blur",function(){b.value!==n&&b.onchange&&b.onchange()});return f},o=function(a){a=a||window.event;var b="",c=a.which,d=a.type;if(c==null)c=a.keyCode;if(c===null)return"";switch(c){case 8:b="bksp";break;case 46:b=d=="keydown"?"del":".";break;case 16:b="shift";break;case 0:case 9:case 13:b="etc";break;case 37:case 38:case 39:case 40:b=!a.shiftKey&&(a.charCode!=39&&a.charCode!==undefined)?"etc":String.fromCharCode(c);break;default:b=String.fromCharCode(c)}return b},e=function(a,b){a.preventDefault&&a.preventDefault();a.returnValue=b||false},r=function(a){a=a||event;if(i){e(a);return false}var c=o(a);if((a.metaKey||a.ctrlKey)&&(c=="X"||c=="V")){e(a);return false}if(a.metaKey||a.ctrlKey)return true;if(b.value==""){b.value=d;j(b,0)}if(c=="bksp"||c=="del"){p(c);e(a);return false}else return true},q=function(a){a=a||event;if(i){e(a);return false}var b=o(a);if(b=="etc"||a.metaKey||a.ctrlKey||a.altKey)return true;if(b!="bksp"&&b!="del"&&b!="shift"){if(!s(b)){e(a);return false}if(p(b)){e(a,true);return true}e(a);return false}else return false},p=function(e){var a=m(b),c=b.value,f="";switch(true){case g.indexOf(e)!=-1:if(++a>d.length)return false;while(l.indexOf(c.charAt(a-1))!=-1&&a<=d.length)a++;f=c.substr(0,a-1)+e+c.substr(a);if(g.indexOf(c.charAt(a))==-1&&k.indexOf(c.charAt(a))==-1)a++;break;case e=="bksp":if(--a<0)return false;while(g.indexOf(c.charAt(a))==-1&&k.indexOf(c.charAt(a))==-1&&a>1)a--;f=c.substr(0,a)+d.substr(a,1)+c.substr(a+1);break;case e=="del":if(a>=c.length)return false;while(l.indexOf(c.charAt(a))!=-1&&c.charAt(a)!="")a++;f=c.substr(0,a)+d.substr(a,1)+c.substr(a+1);a++;break;case e=="etc":return true;default:return false}b.value="";b.value=f;j(b,a);return false},m=function(a){try{if(a.selectionStart>=0)return a.selectionStart;else if(document.selection){var d=a.value,b=document.selection.createRange();b.text="|%|";var c=a.value.indexOf("|%|");b.moveStart("character",-3);b.text="";a.value=d;return c}return-1}catch(e){return-1}},j=function(a,b){try{if(a.selectionStart){a.focus();a.setSelectionRange(b,b)}else if(a.createTextRange){var c=a.createTextRange();c.move("character",b);c.select()}}catch(d){return false}return true},s=function(a){if(g.indexOf(a)==-1&&a!="bksp"&&a!="del"&&a!="etc"){var c=m(b);i=true;t();setTimeout(function(){i=false;j(b,c)},v);return false}return true};f.resetField=function(){b.value=d};f.setAllowed=function(a){g=a;resetField()};f.setFormat=function(a){d=a;this.resetField()};f.setSeparator=function(a){l=a;resetField()};f.setTypeon=function(a){k=a;resetField()};return w()}})(window)